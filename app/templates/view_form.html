{% extends "base.html" %}

{% block title %}{{ form.title }}{% endblock %}

{% block head %}
<style>
    .form-header {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(123, 76, 160, 0.2);
        transform: translateY(0);
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
    }
    
    .form-header:before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        transform: rotate(45deg);
        z-index: 0;
    }
    
    .form-header h2, .form-header p {
        position: relative;
        z-index: 1;
    }
    
    .form-header:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(123, 76, 160, 0.3);
    }
    
    .submit-btn {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        border: none;
        padding: 12px 24px;
        font-weight: 600;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(123, 76, 160, 0.3);
    }
    
    .submit-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(123, 76, 160, 0.4);
    }
    
    .submit-btn i {
        margin-right: 8px;
        transition: transform 0.3s ease;
    }
    
    .submit-btn:hover i {
        transform: translateX(3px);
    }
    
    .form-floating-icon {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--primary-color);
        opacity: 0.7;
    }
    
    .run-btn {
        background: linear-gradient(135deg, #34c759, #2ea043);
        border: none;
        margin-bottom: 10px;
        padding: 8px 16px;
        font-weight: 600;
        font-size: 0.9em;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(52, 199, 89, 0.3);
    }
    
    .run-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(52, 199, 89, 0.4);
    }
    
    .run-btn i {
        margin-right: 5px;
    }
    
    .code-editor {
        font-family: 'Courier New', monospace;
        background-color: #1e1e1e;
        color: #f0f0f0;
        resize: vertical;
    }
    
    .code-output {
        display: none;
        font-family: 'Courier New', monospace;
        background-color: #1e1e1e;
        color: #f0f0f0;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 10px;
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    
    .code-error {
        color: #ff5252;
    }
    
    /* AI Checking Modal Styles */
    #aiCheckingModal .modal-content {
        border-radius: 15px;
        border: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    
    #aiCheckingModal .spinner-border {
        color: var(--primary-color);
    }
    
    @keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.05); opacity: 0.8; }
        100% { transform: scale(1); opacity: 1; }
    }
    
    #aiCheckingModal .modal-title {
        animation: pulse 1.5s infinite;
        color: var(--primary-color);
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="form-header">
            <h2 class="mb-3 display-5">{{ form.title }}</h2>
            <p class="lead mb-0">{{ form.description or "" }}</p>
        </div>
        
        <form method="POST" action="{{ url_for('main.submit_form', form_id=form.id) }}" class="animated-form">
            {% for question in questions %}
                <div class="question-card mb-4" style="animation-delay: {{ loop.index0 * 0.1 }}s">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">{{ question.question_text }}</h5>
                        <span class="badge bg-info">
                            <i class="bi bi-award"></i> {{ question.points }} point{{ 's' if question.points != 1 else '' }}
                        </span>
                    </div>
                    
                    {% if question.question_type == 'multiple_choice' %}
                        {% if question.sample_code %}
                            <div class="mb-3">
                                <label class="form-label">Sample Code:</label>
                                <pre class="code-editor">{{ question.sample_code }}</pre>
                            </div>
                        {% endif %}
                        
                        <div class="mb-3">
                            {% for option in question.get_options() %}
                                <label class="custom-radio w-100 mb-3">
                                    {{ option }}
                                    <input type="radio" name="question_{{ question.id }}" value="{{ option }}" required>
                                    <span class="radio-checkmark"></span>
                                </label>
                            {% endfor %}
                        </div>
                    
                    {% elif question.question_type == 'identification' %}
                        {% if question.sample_code %}
                            <div class="mb-3">
                                <label class="form-label">Sample Code:</label>
                                <pre class="code-editor">{{ question.sample_code }}</pre>
                            </div>
                        {% endif %}
                        
                        <div class="mb-3 position-relative">
                            <input type="text" class="form-control" name="question_{{ question.id }}" 
                                   placeholder="Your answer here..." required>
                            <div class="form-floating-icon">
                                <i class="bi bi-pencil-fill"></i>
                            </div>
                        </div>
                    
                    {% elif question.question_type == 'coding' %}
                        <div class="mb-3">
                            {% if question.sample_code %}
                                <div class="mb-3">
                                    <label class="form-label">Sample Code:</label>
                                    <pre class="code-editor">{{ question.sample_code }}</pre>
                                </div>
                            {% endif %}
                            
                            {% if question.expected_output %}
                                <div class="mb-3">
                                    <label class="form-label">Expected Solution Approach:</label>
                                    <pre>{{ question.expected_output }}</pre>
                                </div>
                            {% endif %}
                            
                            <label class="form-label">Your Solution:</label>


                            <textarea class="form-control code-editor" name="question_{{ question.id }}" 
                                id="code-{{ question.id }}" rows="6" required></textarea>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
            
            {% if questions %}
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary submit-btn">
                        <i class="bi bi-send-fill"></i> Submit Answers
                    </button>
                    <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">Cancel</a>
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> This form doesn't have any questions yet.
                </div>
                <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">Back to Forms</a>
            {% endif %}
        </form>
    </div>
</div>



<!-- AI Checking Modal -->
<div class="modal fade" id="aiCheckingModal" tabindex="-1" aria-labelledby="aiCheckingModalLabel" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-4">
                <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h5 class="modal-title mb-2" id="aiCheckingModalLabel">AI is checking your answers</h5>
                <p class="text-muted">Please wait while our AI processes and evaluates your responses. This might take a moment...</p>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        // Handle form submission to show loading modal
        $('.animated-form').on('submit', function(e) {
            // Show the AI checking modal
            $('#aiCheckingModal').modal('show');
            // Allow form submission to continue
        });
    
        // Add animation to form elements
        $('.animated-form .question-card').each(function(i) {
            $(this).css({
                'animation': 'fadeIn 0.5s ease-out forwards',
                'animation-delay': (i * 0.1) + 's',
                'opacity': '0'
            });
        });
        
        // Add focus effects for form elements
        $('.form-control').focus(function() {
            $(this).closest('.question-card').css('border-left-width', '8px');
        }).blur(function() {
            $(this).closest('.question-card').css('border-left-width', '5px');
        });
        
        // Add hover effects for radio buttons
        $('.custom-radio').hover(
            function() {
                $(this).css('transform', 'translateX(5px)');
            },
            function() {
                $(this).css('transform', 'translateX(0)');
            }
        );
    });
</script>
{% endblock %}
